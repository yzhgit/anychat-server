# Scripts ä½¿ç”¨æŒ‡å—

æœ¬ç›®å½•åŒ…å« AnyChat é¡¹ç›®çš„ç¯å¢ƒç®¡ç†å’ŒæœåŠ¡ç®¡ç†è„šæœ¬ã€‚

## ğŸ“ è„šæœ¬åˆ—è¡¨

### ç¯å¢ƒç®¡ç†

- **`setup-env.sh`** - ç¯å¢ƒæ£€æŸ¥å’Œè®¾ç½®è„šæœ¬
  - æ£€æŸ¥å¼€å‘å·¥å…·ï¼ˆGo, Docker, jq, curl ç­‰ï¼‰
  - æ£€æŸ¥åŸºç¡€è®¾æ–½æœåŠ¡ï¼ˆPostgreSQL, Redis, NATS, MinIOï¼‰
  - æ£€æŸ¥å¾®æœåŠ¡çŠ¶æ€
  - æ£€æŸ¥æ•°æ®åº“è¿æ¥å’Œ Go æ¨¡å—
  - æä¾›å¿«é€Ÿä¿®å¤å»ºè®®

- **`health-check.sh`** - æœåŠ¡å¥åº·æ£€æŸ¥
  - æ£€æŸ¥æ‰€æœ‰å¾®æœåŠ¡çš„ HTTP å¥åº·ç«¯ç‚¹
  - æ£€æŸ¥ gRPC ç«¯å£æ˜¯å¦ç›‘å¬
  - æ£€æŸ¥åŸºç¡€è®¾æ–½æœåŠ¡ç«¯å£
  - æ£€æŸ¥ Docker å®¹å™¨çŠ¶æ€

- **`check-ports.sh`** - ç«¯å£æ£€æŸ¥å·¥å…·
  - æ£€æŸ¥æ‰€æœ‰æœåŠ¡ç«¯å£å ç”¨æƒ…å†µ
  - è¯†åˆ«ç«¯å£å†²çª

### æœåŠ¡ç®¡ç†

- **`start-services.sh`** - å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡
- **`stop-services.sh`** - åœæ­¢æ‰€æœ‰å¾®æœåŠ¡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒæ£€æŸ¥

é¦–æ¬¡ä½¿ç”¨æˆ–é‡åˆ°é—®é¢˜æ—¶ï¼Œè¿è¡Œç¯å¢ƒæ£€æŸ¥ï¼š

```bash
./scripts/setup-env.sh
```

è¿™ä¼šæ£€æŸ¥ï¼š
- âœ“ å¼€å‘å·¥å…·æ˜¯å¦å®‰è£…
- âœ“ Go æ¨¡å—æ˜¯å¦æ­£å¸¸
- âœ“ åŸºç¡€è®¾æ–½æ˜¯å¦è¿è¡Œ
- âœ“ æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸

### 2. å¯åŠ¨åŸºç¡€è®¾æ–½

```bash
# å¯åŠ¨ PostgreSQL, Redis, NATS, MinIO
mage docker:up

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
mage docker:ps

# è¿è¡Œæ•°æ®åº“è¿ç§»
mage db:up
```

### 3. å¯åŠ¨å¾®æœåŠ¡

ä½¿ç”¨ä¸€é”®å¯åŠ¨è„šæœ¬ï¼Œæˆ–åœ¨ä¸åŒç»ˆç«¯åˆ†åˆ«å¯åŠ¨ï¼š

```bash
# ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
./scripts/start-services.sh

# æˆ–æŒ‰éœ€å•ç‹¬å¯åŠ¨
mage dev:auth
mage dev:user
mage dev:friend
mage dev:group
mage dev:message
mage dev:session
mage dev:file
mage dev:gateway
mage dev:push
mage dev:rtc
mage dev:sync
mage dev:admin
```

### 4. å¥åº·æ£€æŸ¥

```bash
./scripts/health-check.sh
```

é¢„æœŸè¾“å‡ºï¼š
```
========================================
åŸºç¡€è®¾æ–½æœåŠ¡
========================================
âœ“ PostgreSQL - ç«¯å£ 5432 æ­£åœ¨ç›‘å¬
âœ“ Redis - ç«¯å£ 6379 æ­£åœ¨ç›‘å¬
âœ“ NATS - ç«¯å£ 4222 æ­£åœ¨ç›‘å¬
âœ“ MinIO API - ç«¯å£ 9000 æ­£åœ¨ç›‘å¬
âœ“ MinIO Console - ç«¯å£ 9091 æ­£åœ¨ç›‘å¬

========================================
HTTP æœåŠ¡
========================================
âœ“ Auth Service - å¥åº· (HTTP 200)
âœ“ User Service - å¥åº· (HTTP 200)
âœ“ Friend Service - å¥åº· (HTTP 200)
âœ“ Gateway Service - å¥åº· (HTTP 200)

========================================
å¥åº·æ£€æŸ¥æ€»ç»“
========================================
å¥åº·æœåŠ¡: 13 / 13 (100%)
âœ“ æ‰€æœ‰æœåŠ¡å¥åº·!
```

## ğŸ”§ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: æœåŠ¡æœªè¿è¡Œ

**é”™è¯¯ä¿¡æ¯**ï¼š
```
âœ— Gateway Service (ç«¯å£ 8080) æœªè¿è¡Œ
éƒ¨åˆ†æœåŠ¡æœªè¿è¡Œï¼Œè¯·å…ˆå¯åŠ¨æ‰€æœ‰æœåŠ¡
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥å“ªäº›æœåŠ¡æœªè¿è¡Œ
./scripts/health-check.sh

# å¯åŠ¨ç¼ºå¤±çš„æœåŠ¡
mage dev:gateway  # æˆ–å…¶ä»–æœåŠ¡
```

### é—®é¢˜ 2: åŸºç¡€è®¾æ–½æœªè¿è¡Œ

**é”™è¯¯ä¿¡æ¯**ï¼š
```
âœ— PostgreSQL - ç«¯å£ 5432 æœªç›‘å¬
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
# å¯åŠ¨åŸºç¡€è®¾æ–½
mage docker:up

# ç­‰å¾…æœåŠ¡å°±ç»ªï¼ˆçº¦10ç§’ï¼‰
sleep 10

# è¿è¡Œæ•°æ®åº“è¿ç§»
mage db:up
```

### é—®é¢˜ 3: ç«¯å£å†²çª

**é”™è¯¯ä¿¡æ¯**ï¼š
```
bind: address already in use
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
./scripts/check-ports.sh

# æˆ–æ‰‹åŠ¨æ£€æŸ¥
lsof -i :8080

# åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
kill -9 <PID>
```

### é—®é¢˜ 4: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: database connection failed
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥ PostgreSQL çŠ¶æ€
docker ps | grep postgres

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
PGPASSWORD=anychat123 psql -h localhost -U anychat -d anychat -c "SELECT 1"

# å¦‚æœå¤±è´¥ï¼Œé‡å¯ PostgreSQL
docker restart postgres
```

### é—®é¢˜ 5: jq å‘½ä»¤æœªæ‰¾åˆ°

**é”™è¯¯ä¿¡æ¯**ï¼š
```
éœ€è¦å®‰è£… jq å·¥å…·
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
# Ubuntu/Debian
sudo apt-get install jq

# macOS
brew install jq

# CentOS/RHEL
sudo yum install jq
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **å¼€å‘å‰æ£€æŸ¥ç¯å¢ƒ**
   ```bash
   ./scripts/setup-env.sh
   ```

2. **å®šæœŸè¿è¡Œå¥åº·æ£€æŸ¥**
   ```bash
   ./scripts/health-check.sh
   ```

3. **é‡åˆ°é—®é¢˜æ—¶æŸ¥çœ‹æ—¥å¿—**
   ```bash
   # æŸ¥çœ‹åŸºç¡€è®¾æ–½æ—¥å¿—
   mage docker:logs

   # æŸ¥çœ‹ç‰¹å®šå®¹å™¨æ—¥å¿—
   docker logs postgres
   docker logs redis
   ```

4. **æ¸…ç†å’Œé‡å¯**
   ```bash
   # åœæ­¢æ‰€æœ‰æœåŠ¡
   mage docker:down

   # æ¸…ç†æ„å»ºäº§ç‰©
   mage clean

   # é‡æ–°å¯åŠ¨
   mage docker:up
   mage db:up
   ```

## ğŸ“š æ›´å¤šèµ„æº

- [é¡¹ç›® README](../README.md)
- [API æµ‹è¯•](../tests/README.md)
- [API æ–‡æ¡£](../docs/api/)
- [å¼€å‘æŒ‡å—](../docs/development/)
- [è®¾è®¡æ–‡æ¡£](../docs/design/)

## ğŸ“„ è®¸å¯è¯

MIT License
