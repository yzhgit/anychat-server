# NATS Server 配置 - AnyChat IM 系统
# 文档: https://docs.nats.io/running-a-nats-service/configuration

# ===== 服务器基本设置 =====
server_name: "anychat-nats"
host: "0.0.0.0"
port: 4222

# ===== 监控（HTTP） =====
http_port: 8222

# ===== 连接限制 =====
# 12个微服务 × 多实例，预留冗余
max_connections: 1024

# IM消息本身较小（文件走 MinIO），4MB 已充裕
max_payload: 4MB

# ===== 慢消费者保护 =====
# 每个连接待发送缓冲上限（64MB）
# push-service 使用 notification.> 订阅全量消息，需要足够缓冲
max_pending: 67108864

# 写超时：超过该时间未写完则断开慢连接
write_deadline: "10s"

# ===== Ping/Pong 保活 =====
ping_interval: "60s"

# ===== JetStream（消息持久化与重放） =====
# 当前业务使用 Core NATS Pub/Sub，JetStream 为未来可靠投递预留
jetstream {
  store_dir: "/data/jetstream"
  # 最大磁盘存储（1GB）
  max_file_store: 1GB
  # 最大内存存储（256MB），用于低延迟场景
  max_memory_store: 256MB
}

# ===== 日志 =====
logtime: true
log_size_limit: 67108864  # 64MB 后轮转

# debug: false
# trace: false
